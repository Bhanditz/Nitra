using N2;

syntax module N2Parser
{
    using ModifierParser;
    using AttributeParser;

    token field Semicolon           = ";";
    token field Eq                  = "=";
    token field OpenBrace           = "(";
    token field CloseBrace          = ")";
    token field OpenBrace           = "{";
    token field CloseBrace          = "}";
    token field OpenSquareBrace     = "[";
    token field CloseSquareBrace    = "]";

    alias NsOrTypeName  = QualifiedIdentifier;
    alias QualifiedName = QualifiedIdentifier;
    alias Name          = Identifiers;

    token any = ['\u0000'..'\uFFFF'];

    [StartRule]
    syntax CompilationUnit = s NamespaceBody !any;

    syntax NamespaceBody = NamespaceMember*;

    syntax NamespaceMember;

    syntax UsingImportDeclaration is NamespaceMember = "using"S     QualifiedIdentifier    ";"nl;
    syntax UsingAliasDeclaration  is NamespaceMember = "using"S     Identifier as Alias sm "="sm NsOrTypeName ";"nl;
    syntax NamespaceDeclaration   is NamespaceMember = "namespace"S QualifiedName nl       "{" inl Namespace { NamespaceBody } as Body d "}" nl;

    token IdentifierFirst = ['A'..'Z', 'a'..'z', '_'..'_'];
    token IdentifierNext  = IdentifierFirst | ['0'..'9'];
    token IdentifierBody  = IdentifierFirst IdentifierNext*;

    syntax Identifier          = IdentifierBody s;
    syntax QualifiedIdentifier = (Identifier; "."s)+;

    syntax Expression;

    token newLineCharacter   = '\n'
                       | '\r'
                       | '\u2028'    /*  line separator       */
                       | '\u2029';   /*  paragraph separator  */
    token newLine   = "\r\n" | newLineCharacter;

    token whitespace = [Zs]
              | '\t'
              | '\v'        /*  vertial tab          */
              | '\f';       /*  form feed            */

    token space = whitespace | newLine;

    void s   = space*;            // optional spacer
    void i = ' '*;                // increase a indent
    void d = ' '*;                // decrease a indent
    void nl  = space*;            // optional spacer and plase for \n while pretty printing
    void inl = space*;            // inl
    void sm  = space*;            // optional spacer and prefer to print space while pretty printing
    void S   = !IdentifierNext s; // identifier break spacer
}
