using CSharp.Utils;
using Nitra.Runtime.Binding;

namespace CSharp
{
  abstract declaration Namespace : NamespaceMemberDeclaration
  {
    sealed symbol
    {
      Kind      = "namespace";
      SpanClass = NitraCSharpLanguage.NamespaceSpanClass;
      Scope     = MemberTable;

      out MemberTable : TableScope = TableScope(this.ToString(), this);

      IsSameIdentity = SymbolUtils.IsSameIdentity(0, candidate);
      CanMerge       = candidate is Namespace;
    }
  }

  declaration ImplicitNamespace : Namespace
  {
    inout ParentPipe : NamespaceSymbol;

    Parent                          = ParentPipeIn;
    Symbol.Parent                   = Parent;
    ContainingTable                 = ParentPipeIn.MemberTable;
    ParentPipeOut                   = Symbol;
  }

  abstract ast NamespaceBody : BindableAst
  {
  stage 1:
    out EnteredScope : Scope;

    Members.OpeningIn         = [];
    Members.UsingAliasesScope = TableScope("aliases", null);
    Members.CurrentScope      = Scope;
    Members.Scope             = MakeMembersScope(EnteredScope, Members.OpeningOut, Members.UsingAliasesScope);

    Members         : NamespaceMember*;
  }

  declaration ExplicitNamespace : Namespace, NamespaceBody
  {
    EnteredScope                    = MakeEnteredScope(Scope, Parent, Symbol);
    Path.ParentPipeIn               = Parent;
    ContainingTable                 = Path.ParentPipeOut.MemberTable;
    Members.Parent                  = Symbol;
    Symbol.Parent                   = Path.ParentPipeOut;

    Path            : ImplicitNamespace*;
  }
}
