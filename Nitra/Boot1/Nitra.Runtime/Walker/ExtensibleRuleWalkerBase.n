using Nemerle;
using Nemerle.Imperative;
using Nemerle.Collections;
using Nemerle.Text;
using Nemerle.Utility;

using System;
using SCG = System.Collections.Generic;
using System.Linq;
using Nitra.Internal;

namespace Nitra.Runtime
{
  public abstract class ExtensibleRuleWalkerBase
  {
    public PrefixId             : int;
    public PostfixId            : int;
    public FirstPostfixRule     : int;
    public FirstPostfixRuleId   : int;
    public PrefixWalkersOffset  : int;
    public PostfixWalkersOffset : int;
    public RuleParser           : ExtensibleRuleParser;

    public this(ruleParser : ExtensibleRuleParser)
    {
      RuleParser            = ruleParser;
      PrefixId              = ruleParser.PrefixId;
      PostfixId             = ruleParser.PostfixId;

      FirstPostfixRule      = ruleParser.FirstPostfixRule;
      FirstPostfixRuleId    = ruleParser.FirstPostfixRuleId;

      PrefixWalkersOffset   = if (ruleParser.PrefixRules.Length > 0)  ruleParser.PrefixRules[0].RuleId  else 0; //FIXME empty array
      PostfixWalkersOffset  = if (ruleParser.PostfixRules.Length > 0) ruleParser.PostfixRules[0].RuleId else 0; //FIXME empty array
    }

    public RuleFullName : string
    {
      get { this.RuleParser.Descriptor.Grammar.Name + "." + this.RuleParser.Descriptor.Name }
    }
  }
}
